# 数据分析服务

## 总体架构

![architecture](https://github.com/maodoutech/my-bitcoin/blob/master/temp/data_service.webp)

### 数据层

基础数据的质量、时效性、多样性很大程度决定了产品最终对外的效果，根据之前做策略的经验可能做了
很多算法优化，可能不如增加一个数据源。稍微提下架构图里面的原始区块数据，对于区块浏览器浏览器
里面的数据理论上也是解析P2P节点下的数据文件或者RPC访问节点服务获取到，像btc、eth底层存储是基
于leveldb，实际上只要搭建一个节点同步区块数据，就能实时获取到交易数据。

### 采集层

采集数据ETL处理.抓取需要考虑时效性、数据量、站点屏蔽、限流。区块数据解析需要针对不同公链搭建节点
（能参与结账的公链）按照存储协议解析数据。对于一些有价值的第三方数据可以考虑数据交换或者购买。

### 存储层

结构化数据存储可以使用mysql，对于高频访问修改可以使用redis，区块数据需要存储（目前也不大）需
要存储到hdfs，方便使用MR或者spark进行解析。

### 分析层

通过采集到的数据进行分析，比如牛市有哪些指标、一个好的token有那边指标等。来进行预测或决策。

### 服务层

通过RPC或者线下对接将数据或者分析结果推送出去


## Example

这次小练习大致也是按照上面的架构实现。数据层采用的是区块链浏览器的数据，采集层使用的是HttpClient，
使用jsoup进行html解析，存储用的是mysql并根据不同的erc2.0的合约地址进行分表，通过node.js提供http
方式访问。

***遇到问题***

1. 为提高效率采集和存储通过消息队列分开，不过如何采集线程开的比较大会导致限流。目前是采用2线程，EOS 
30万用户数据大概需要5-6小时。解决方式是使用第三方代理。

2. 很多用户Token数据很少不需要采集

3. 由于采集是基于分页的方式，肯定会有不一致的情况，目前这个没想到好的解决方法。

4. rank会有不一致的情况
